## AMD

If you are running an AMD Radeon graphics card, then you have already installed the drivers for it! Because they are open source, the drivers have been written into the Linux kernel and are loaded on boot already, so no need to take any extra steps.

## NVIDIA

For NVIDIA drivers, we have 2 options: `nvidia` and `nvidia-open`. The `nvidia` package is the standard, proprietary, fully closed-source drivers from NVIDIA. The `nvidia-open` package is similar, except that the kernel module is open-source. It works only with newer card (30 series and up) and allows for your drivers to interface better with the Linux kernel and take advantage of some more features. I usually stick with the standard `nvidia` package as I have been using it for a while.

We also have to choose between the `nvidia` and `nvidia-dkms` packages. There are equivalents for `nvidia-open` (`nvidia-open-dkms`) if you plan to use that instead. 

With the standard `nvidia` package, you download the precompiled driver from the repo. This is a faster installation process but requires you to be on the standard Linux kernel (`nvidia-lts` for `linux-lts`). If you are on another kernel such as `zen` or `linux-hardened`, these drivers will be incompatible, and whenever there is a kernel update, you will likely have to wait for a driver update and risk the current version of the driver not working with the current version of your kernel, forcing you to downgrade, even if you are running the standard kernel. 

`nvidia-dkms` on the other hand builds the driver locally on your machine on first install and whenever there is a kernel update. This means that you are always building against your kernel, meaning that no matter which kernel you have or what version of the kernel, you will have a compatible NVIDIA driver, which is why I always choose `nvidia-dkms` over `nvidia`. This does result in a longer time to install, since you have to build it yourself, but it is worth it to reduce the headache that is NVIDIA drivers on Linux.

We can install the NVIDIA graphics card drivers and related packages with:

```bash
pacman -S nvidia-dkms nvidia-utils lib32-nvidia-utils libglvnd lib32-libglvnd opencl-nvidia lib32-opencl-nvidia nvidia-settings linux-headers
```

The `linux-headers` package is crucial, as we need those headers to be able to build the drivers locally.

Now we need to add the modules for `nvidia` to our `initramfs`. Open the `mkinitcpio` configuration file with:

```bash
nano /etc/mkinitcpio.conf
```

Find the `MODULES=()` line towards the top of the file and add these modules:

```bash
MODULES=(nvidia nvidia_modeset nvidia_uvm nvidia_drm)
```

We can then regenerate the `initramfs` with:

```bash
mkinitcpio -P
```

Then we can add a line to our `grub` configuration file by opening it with:

```bash
nano /etc/default/grub
```

From there, find the line that starts with `GRUB_CMDLINE_LINUX_DEFAULT` and add this to the end of it:

```bash
nvidia_drm.modeset=1
```

Then we will regenerate our grub configs with:

```bash
grub-mkconfig -o /boot/grub/grub.cfg
grub-mkconfig -o /boot/efi/EFI/GRUB/grub.cfg
```

Lastly, we need to add a hook to `pacman` to have it regenerate the `initramfs` whenever the `nvidia-dkms` package is updated, since we added those modules to the `mkinitcpio.conf` file. We will first need to make a `hooks` directory in the `pacman` directory if it does not already exist with:

```bash
mkdir -p /etc/pacman.d/hooks/
```

Then we will create and open a new hook like so:

```bash
nano /etc/pacman.d/hooks/nvidia.hook
```

In this file, paste this:

```bash
[Trigger]
Operation=Install
Operation=Upgrade
Operation=Remove
Type=Package
Target=nvidia

[Action]
Depends=mkinitcpio
When=PostTransaction
Exec=/usr/bin/mkinitcpio -P
```

This will cause the `initramfs` to be regenerated whenever the `nvidia` package is installed, removed, or updated.

