## Why use an LVM?

Using a Logical Volume Manager (LVM) rather than normal partitions gives us several advantages. In the event we have multiple physical drives, an LVM can present these to the OS as 1 drive, meaning we can extend something like the home partition with a second drive without Linux seeing it as a separate drive and having us mount it to a directory. 

But LVMs are still very useful even when using only one drive. Resizing standard partitions can be a pain. You may need to extend the swap file in the event you upgrade your available memory or need to extend the root partition, which is a cumbersome process, usually requiring you to back up partition data to another device, reformatting the partitions in your current one (thus deleting all data in them), and then loading the backup back into your newly formatted partitions. LVMs do away with this, as they make it extremely easy to add and remove space from different volumes in a volume group.

There is also the consideration that, since we are encrypting our sensitive data (the swap file, root and home partitions), keeping them under 1 partitions and grouped into logical volumes means we only need to enter 1 password at boot for the 1 partition rather than 3, though this will be elaborated on more later in the guide.

## Creating the Volume Group

We first need to create a volume group, which can be thought of as the 'disk' in the world of LVMs. To initialize each of our decrypted devices for use in a volume group, we must use:

```bash
pvcreate /dev/mapper/<your-decrypted-device>
```

Use this command on all devices if you have more than 1. Then, to create the volume group, we can use:

```bash
vgcreate arch /dev/mapper/<your-decrypted-device1> /dev/mapper/<your-decrypted-device2> ...
```

`arch` is the name I choose for the volume group, which can of course be changed to anything you want.

## Creating the Volumes

Now that the volume group is created, we can start adding volumes to it.

First is the root volume. The minimum recommended size for the root volume is 40 GB, though I would personally recommend 50 GB for standard users and extending that further for developers, as you will find that root will fill up very quickly with the IDEs, runtimes, compilers, libraries, virtual machines, etc. you end up installing on them. I usually do 100 GB as I have a lot of space and it is usually enough to work with, though it is an easy process to extend later if needed.

```bash
lvcreate -n root -L 100G arch /dev/mapper/<your-first-device>
```

You will notice the extra `/dev/mapper/<your-first-device>`, which refers to the main drive (if you have multiple) where your boot partitions live. This tells the LVM to keep all data for this volume physically on this first drive only and not store any data in any other drives in the volume group. The reason I do this is to ensure that I only need to provide 1 decryption passphrase at boot despite having multiple encrypted devices. This will be explained later in the guide.

It is recommended that the swap file is your available memory plus 2 additional GB as a buffer. My machine has 32 GB of memory, so I will be making it 34 GB in size. To do this, we can use:

```bash
lvcreate -n swap -L 34G -C y arch
```

- -n: the name of the volume
- -L: the size of the volume
- -C: set this volume as contiguous, which is ideal for the swap file. The `y` is to confirm this.

Lastly, we have the home volume, which will be using all remaining data in the volume group. To do that, we will enter:

```bash
lvcreate -n home -l 100%FREE arch
```

Now that we have created all of our volumes, we should be able to view them using `lsblk` to ensure all looks good. You should see `arch-root` under your first device, and `arch-swap` and `arch-home` will be under one or both depending on the size of your drives.